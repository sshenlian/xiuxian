F.addLog("mancard:skeleton/card",{scrollLoad:"4010311000"});F.module("mancard:skeleton/card",function(require,exports,ctx){var OneCard=function(){var _cssReg=/<link[^>]*href="(.*?)"[^>]*>/;var _menuDom=$("#s_menus_wrapper");var _centerMen=$("#s_ctner_menus");var _isPull="";function OneCard(id,name,state){this.id=""+id||"";this.loaded=0;this.offsetUsed=false;this.html="";this.name=name||"";this.state=state||"";this.mainDom=$("#s_content_"+this.id)
;this.mainDom=this.mainDom[0]?this.mainDom:_cardMaker({id:this.id});this.waterDom=null;this.noMore=false;this.myMen=null;this.rendered=false;this.waterPage=0;this.waterLoading=false;this.cutnetTimes=0;this.prevRidsArr=window.s_session.rids||[];this.repeatNum=0;this.ridsHash={};this.params={};this.forceLoad=false}OneCard.prototype={constructor:OneCard,load:function(cb){var _ctx=this;if(_ctx.id!=""){if(_ctx.loaded===0||_ctx.forceLoad){_ctx.loaded=1;_ctx.params.id=_ctx.id;_loadCardHtml(_ctx.params,
function(data){_ctx.loaded=2;_ctx.sessionId=data.sessionId;_ctx.prevRidsArr=data.rids;for(var i=0,dataRids=data.rids||[],l=dataRids.length;i<l;i++){_ctx.ridsHash[dataRids[i]]=true}_ctx.html=data.html.replace(_cssReg,"");if(data.isEnd==1){_ctx.noMore=true}_ctx.loadCss(data.html,cb)})}}},loadCss:function(html,cb){var match,href;if(html){match=html.match(_cssReg);if(match){href=match[1];$('<link rel="stylesheet" type="text/css" href="'+href+'" />').on("load",function(){cb&&cb(html)}).appendTo(head)
;if($.browser.safari&&window.navigator.platform==="Win32"){cb&&cb(html)}}else{cb&&cb(html)}}else{ctx.fire("syncNomore",{cardId:this.id})}},appendData:function(cb,toggle,$dom){var _ctx=this;if(_ctx.noMore||_ctx.waterLoading||!_ctx.rendered){if(_ctx.noMore){toggle&&toggle(false)}return false}if(!_ctx.loadDom){_ctx.loadDom=_ctx.mainDom.find(".s-loading")}_ctx.waterLoading=true;toggle&&toggle(false);var params={id:_ctx.id,offset:_ctx.waterPage,sessionId:_ctx.sessionId,crids:window.s_session.crids}
;var paraDom=_ctx.mainDom||$("#s_content_"+_ctx.id);var extraParam=paraDom.attr("data-waterpara");if(!extraParam&&paraDom.find(".s-xmancard").attr("data-waterpara")){extraParam=paraDom.find(".s-xmancard").attr("data-waterpara")}if(extraParam){var regx=/([s\S]*?)\=([\s\S]*?)\;/g;var result=null;while(result=regx.exec(extraParam)){if(result[1]==="offset"){if(!_ctx.offsetUsed){params[result[1]]=result[2];_ctx.waterPage=result[2];_ctx.offsetUsed=true}}else{params[result[1]]=result[2]}}}ctx.fire(
"beforeLoading");_ctx.loadDom.show();ctx.fire("scrollLoad");F.use("mancard:skeleton/model",function(dao){dao.get("waterHtml",function(data){if(!_ctx.waterDom){_ctx.waterDom=$(".water-container",_ctx.mainDom)}if(params.childId==="1_1"&&params.sessionId==="0"){_ctx.ridsHash={}}var repeat=_ctx.validateRid(data);var waterFunc=[function(){var target=$dom||_ctx.waterDom;target.append(data.html);_ctx.waterLoading=false;_ctx.loadDom.hide();if(data.isEnd=="1"){_ctx.emitNoMore(_ctx.loadDom)
;_ctx.noMore=true}_ctx.waterPage++;_ctx.mainDom.attr("data-loaded",1);if(_ctx.id===2&&data.isEnd==="0"){_ctx.mainDom.find("div[data-waterpara]").attr("data-waterpara","version="+data.version+";"+data.waterpara)}ctx.fire("cardloaded",{cardId:_ctx.id,loadData:data});cb&&cb.call(_ctx,data)},function(){setTimeout(function(){_ctx.waterLoading=false;_ctx.appendData(cb,toggle)},50)},function(){setTimeout(function(){_ctx.waterLoading=false;_ctx.appendData(cb,toggle)},50)},function(){setTimeout(function(
){_ctx.waterLoading=false;_ctx.appendData(cb,toggle)},50)},function(){$.ajaxpost(s_domain.baseuri+"/page/data/pageserver",{errno:7009});_ctx.emitNoMore(_ctx.loadDom);_ctx.noMore=true}];_isPull=_isPull===""||_isPull==1?"1":undefined;_ctx.cutnetTimes=0;waterFunc[repeat]()},params).fail(function(){$.ajaxpost(s_domain.baseuri+"/page/data/pageserver",{errno:8001});_ctx.cutnetTimes++;if(_ctx.cutnetTimes<=3){_ctx.waterLoading=false;_ctx.appendData(cb,toggle)}else{_ctx.emitNoMore(_ctx.mainDom.find(
".s-loading"))}})});return true},validateRid:function(data){var _ctx=this;var nextArr=data.rids||[];var isRepeat=0;var len=nextArr.length;for(var i=0;i<len;i++){if(!!nextArr[i]&&!!_ctx.ridsHash[nextArr[i]]){isRepeat=1}}if(isRepeat===1){_ctx.repeatNum++}else if(_ctx.repeatNum>0){_ctx.repeatNum=0}if(isRepeat===0){for(i=0;i<len;i++){_ctx.ridsHash[nextArr[i]]=true}}_ctx.prevRidsArr=nextArr;return _ctx.repeatNum},render:function(cb){var _ctx=this;$("#s_ctner_contents").append(this.mainDom);_ctx.load(
function(html){var $curDom=$(_ctx.html);_ctx.mainDom.html($curDom);if(_ctx.noMore){_ctx.emitNoMore(_ctx.mainDom.find(".s-loading"))}_ctx.rendered=true;cb&&cb();ctx.fire("cardinitloaded")});return _ctx},add2Men:function(cb){var _ctx=this;if(!_ctx.myMen){var tpl=_menuMaker({id:this.id,name:this.name});_ctx.myMen=$(tpl)}if(this.id==="3"){_menuDom.parent().append(_ctx.myMen);F.call("newmusic:index","init")}else{_menuDom.append(_ctx.myMen)}_ctx.myMen.show();_ctx.render();return _ctx},
del4Men:function(cb){var _ctx=this;if((_ctx.myMen=$("[data-id="+this.id+"]",_menuDom))[0]){_ctx.myMen.hide();_ctx.mainDom.hide();_ctx.state=""}return _ctx},show:function(cb){var _ctx=this;if(this.rendered){if(_isPull==1&&this.waterPage==0){this.appendData(function(data){})}this.mainDom.stop().show()}else{this.render(function(){cb&&cb.call(this)});this.mainDom.stop().show()}cb&&cb.call(this);this.getMyMen().addClass("current");return this},hide:function(cb){this.mainDom.stop().hide()
;this.getMyMen().removeClass("current");cb&&cb.call(this);return this},getMyMen:function(){return this.myMen||(this.myMen=$("[data-id="+this.id+"]",_centerMen))},emitNoMore:function($dom){$dom=$dom||this.mainDom.find(".s-loading");$dom.find(".load-text").addClass("no-more").html("没有更多内容了").end().find("img").hide().end().prepend('<div class="load-done"></div>').show();if(this.id==100||this.id=="1"||this.id=="22"||this.id==24){$dom.hide()}ctx.fire("cardLoadDone",{cardId:this.id})},
resetNoMore:function($dom){$dom=$dom||this.mainDom.find(".s-loading");$dom.hide().find(".load-text").removeClass("no-more").html("正在加载中").end().find("img").show().end().find(".load-done").remove()},setForceLoad:function(force){this.forceLoad=force},addParam:function(name,value){this.params[name]=value}};function _menuMaker(set){var tpl;if(set.id==="3"){tpl='<div class="s-menu-music" data-id="#{id}"></div>'}else if(set.id==="5"){tpl=[
'<span class="s-menu-item s-opacity-white-background" data-id="#{id}">',"<span>#{name}</span>",'<span class="bar-bg" data-tid="7779"></span>',"</span>"].join("")}else if(set.id==="24"){tpl=['<span class="s-menu-item s-opacity-white-background" data-id="#{id}">',"<span>#{name}</span>",'<span class="bar-bg" data-tid="7999"></span>',"</span>"].join("")}else{tpl=['<span class="s-menu-item s-opacity-white-background" data-id="#{id}">',"#{name}","</span>"].join("")}return $.formatString(tpl,set)}
function _cardMaker(set){var loading=s_domain.staticUrl+"static/mancard/img/loading-f9b765014b.gif";if(window.isNewGridCard===1){loading=s_domain.staticUrl+"static/mancard/img/loading_new-f4a658cef0.gif"}var tpl=""+'<div id="s_content_#{id}" data-id="#{id}" class="s-content" style="display:none;">'+'<div class="s-content-load '+(window.isNewGridCard===1?"":"s-opacity-white-background")+'">'+'<img src="#{loadingImg}" />'+(window.isNewGridCard===1?"":"<div>加载中，精彩马上呈现</div>")+"</div>"+"</div>"
;$.extend(set,{staticUrl:s_domain.staticUrl,loadingImg:loading});return $($.formatString(tpl,set))}function _loadCardHtml(params,cb){if(params.id==="5"&&!params.childId){params.childId="0"}params.isPull=_isPull||"";F.use("mancard:skeleton/model",function(dao){dao.get("cardHtml",function(data){cb&&cb(data)},params)})}return OneCard}();return OneCard});
F.module("mancard:skeleton/model",function(require,exports,tool){var _uri="/home/pcweb/";var _uri_mancardwater=window.is_login===0?"/home/page/":_uri;function Dao(){}var _getter={waterHtml:function(cb,param){var _id=param.id||0,page=param.page||1;var defer=$.Deferred();if(param.id==="1"&&!s_session.isLogin){cb({html:$("#s_content_2_more_textarea").text(),sessionId:"",isEnd:true});defer.resolve();return defer}if(+param.noload===1){cb&&cb({html:""});defer.resolve()}else{return $.ajaxget(
_uri_mancardwater+"data/mancardwater?"+$.param(param),function(data){cb&&cb(data)})}return defer},cardHtml:function(cb,param){if(param.id==="1"&&!s_session.isLogin){cb({html:$("#s_content_2_textarea").text(),sessionId:""});return}var getStr=$.param(param);$.ajaxget(_uri_mancardwater+"data/mancardhtml?"+getStr,function(data){cb&&cb(data)})}};var _setter={curmenu:function(value,cb,param){var id=value||0;$.ajaxpost(_uri+"submit/mancardmenu",{id:value},function(data){cb&&cb(data)})}};Dao.prototype={
get:function(key,cb,param){return _getter[key]&&_getter[key](cb,param)||false},set:function(key,value,cb,param){return _setter[key]&&_setter[key](value,cb,param)||false}};return new Dao});
F.module("mancard:skeleton/card_collection",function(require,exports,ctx){var OneCard=require("mancard:skeleton/card");var _menuGurd=$("#s_menu_gurd");var _topWrap=$("#s_top_wrap");var _container=$("#s_mancard_main .s-menu-container");function CardCollection(){this.pool={};this.curId=s_session.curmod;this._options={};this.menuTopShowed=false}CardCollection.prototype={constructor:CardCollection,add:function(aCard,name,state){if(aCard instanceof OneCard){return this.pool[aCard.id]=aCard}else if(
typeof parseInt(aCard)=="number"&&name!=null&&state!=null){return this.pool[""+aCard]=new OneCard(aCard,name,state)}return aCard},remove:function(aCard){if(aCard instanceof OneCard){this.pool[aCard.id]=null}else if(typeof parseInt(aCard)=="number"){this.pool[""+aCard]=null}return aCard},get:function(id){return this.pool[""+id]},createCard:function(id,name,state){if(this.pool[id]){return this.pool[""+id]}return new OneCard(id,name,state)},switchCard:function(id,cb){var _ctx=this;if($(
"#s_top_wrap").hasClass("s-down")){if(_ctx.pool[""+id].waterPage==0){if($.isIE<9){_ctx.fixIE(0,function(){})}else{window.scrollTo($(window).scrollLeft(),0)}}else{var sTop=Math.max($("#s_ctner_contents").offset().top-110,0);_ctx.fixIE(sTop,function(){})}}_ctx.cardDone(id,cb)},cardDone:function(id,cb){var _ctx=this;_ctx.pool[_ctx.curId].hide(function(){window.s_session.curmod=_ctx.curId=""+id;_ctx.pool[""+id].show(function(){F.use("mancard:skeleton/model",function(dao){dao.set("curmenu",_ctx.curId
)});cb&&cb()})})},getMenuIDS:function(){var menuNodes=$("#s_menus_wrapper").find(".s-menu-item"),ids=[];$.each(menuNodes,function(idx,item){ids.push($(item).attr("data-id"))});return ids},toggleMenu:function(show,noAnimate){var _ctx=this;var _topNavWrap=_topWrap.children(".s-top-nav");if(!!show){_menuGurd.addClass("s-down");if($("#s_upfunc_menus .s-lite").hasClass("hide-icon")||!$("#bottom_layer .s-bottom-show").css("display")==="none"||!$("#s-user-setting-menu").hasClass("hiding-feed")){
_topNavWrap.append(_menuGurd)}if(!_ctx.menuTopShowed){_topNavWrap.css("display","block");_menuGurd.css({marginTop:-1*_menuGurd.height()}).stop().animate({marginTop:"0"},150)}_ctx.menuTopShowed=true}else{if(noAnimate){_menuGurd.removeClass("s-down");_container.append(_menuGurd)}else{_menuGurd.css({marginTop:"0"}).stop().animate({marginTop:-1*_menuGurd.height()},150,function(){_topNavWrap.css("display","none")})}_ctx.menuTopShowed=false}ctx.fire("showTopMenu",{show:show})},options:function(){
switch(arguments.length){case 0:return this._options;case 1:return this._options[arguments[0]];case 2:return this._options[arguments[0]]=arguments[1]}},fixIE:function(top,cb){var _ctx=this;$("html,body").animate({scrollTop:top},500,function(){cb&&cb.call(_ctx)})}};return new CardCollection});
F.addLog("mancard:skeleton/card_showLog",["cardItemShow"]);F.module("mancard:skeleton/card_showLog",function(require,exports,ctx){var cards=require("skeleton/card_collection");var alsLog=require("skeleton/card_alsLog");var thunder=window.Thunder.get();var idsMap={};var windowHeight=$(window).height();var defaultLog={logactid:"1100000004"};function itemShowLog(){var curNodeWrap=$("#s_content_"+cards.curId),items=curNodeWrap.find("[data-rid]"),item=null,ids=idsMap[cards.curId]||[];var temp=[],
posTemp=[],extras=[],mapObjArr={};var logExtra=[];for(var i=0;i<items.length;i++){item=items.eq(i);var extra=item.attr("data-extra");var rid=item.attr("data-rid");var tlog;var curLog=item.attr("data-log");if(curLog){curLog=curLog.replace(/\;$/g,"")}if($.inArray(rid,ids)!=-1){continue}if(item.offset().top+item.height()/2-$(window).scrollTop()<windowHeight){if(item.hasClass("s-nativead-item")){alsLog.sendAlsShowLog({},{da_locate:+item.attr("data-locate"),extra_param:item.attr("data-extra-param")})
;var cpmRcvUrl=item.attr("data-cpm-rcv-url");if(cpmRcvUrl){imgLog(cpmRcvUrl)}if(item.hasClass("nativead-empty-order")){ids.push(rid);continue}}if(/logactid/g.test(curLog)){if(curLog){splitLog(curLog,mapObjArr)}ids.push(rid);var param={};for(var i in mapObjArr){param[i]=mapObjArr[i].join(",")}ctx.fire("cardItemShow",param);continue}if($.inArray(rid,ids)==-1){temp.push(rid);var curtemp={rid:rid,extra:extra,flow:2};if(curLog){splitLog(curLog,mapObjArr);splitLogToObj(curLog,curtemp)}posTemp.push(i)
;ids.push(rid);extras.push(extra);logExtra.push(curtemp)}}}idsMap[cards.curId]=ids;if(temp.length!=0){var param={rids:temp.join(","),pos:posTemp.join(","),extra:extras.join(",")};for(var i in mapObjArr){param[i]=mapObjArr[i].join(",")}var mergedParam=$.extend({},defaultLog,param);ctx.fire("cardItemShow",mergedParam);logext_str=$.stringify(logExtra);if(+s_session.curmod===2){thunder.send({cst:1,tid:27,logExtra:logext_str.substr(1,logext_str.length-2)})}}}function imgLog(src){
var n="cpm_rcv_url__"+(new Date).getTime();var c=window[n]=new Image;c.onload=c.onerror=function(){window[n]=null};c.src=src;c=null}function splitLog(curLog,mapObjArr){var keyvalue=[];var key="";var value="";var clrChuo="";var paraString=curLog.split(";");for(var j=0;j<paraString.length;j++){keyvalue=paraString[j].split(":");key=keyvalue[0];value=keyvalue[1];if(!/-0$/g.test(key)){if(/-1$/g.test(key)){key=key.replace(/-1$/g,"")}if(!mapObjArr[key]){mapObjArr[key]=[]}mapObjArr[key].push(value)}}}
function splitLogToObj(curLog,mapObjArr){var keyvalue=[];var key="";var value="";var paraString=curLog.split(";");for(var j=0;j<paraString.length;j++){keyvalue=paraString[j].split(":");key=keyvalue[0];value=keyvalue[1];mapObjArr[key]=value}}exports.itemShowLog=itemShowLog});
F.module("mancard:skeleton/card_alsLog",function(require,exports,ctx){function imgLog(src){var n="imglog__"+(new Date).getTime();var c=window[n]=new Image;c.onload=c.onerror=function(){window[n]=null};c.src=src;c=null}var ALSLOG_TYPE={CLICK:2,SHOW:3};function AlsLog(){this.init()}AlsLog.prototype={constructor:AlsLog,init:function(){this.alsHostHttp="http://als.baidu.com/clog/clog";this.alsHostHttps="https://als.baidu.com/clog/clog";var productId=39;var clientType=0;var baiduId=$.cookie.get(
"BAIDUID");this.alsCommonFields=this.buildAlsParams(productId,clientType,baiduId)},buildAlsParams:function(productId,clientType,baiduId){return{productId:productId,_client_type:clientType,baiduId:baiduId}},sendAls:function(data){var paramList=[];for(var key in data){paramList.push([encodeURIComponent(key),"=",encodeURIComponent(data[key])].join(""))}imgLog(this.alsHostHttps+"?"+paramList.join("&"))},buildAlsLogData:function(logContent,adContent){var ad=encodeURIComponent($.stringify([$.extend({
da_page:"index",da_page_num:1,da_locate:1,origin_time:+new Date},adContent)]));return $.extend({},this.alsCommonFields,logContent,{ad:ad})},sendAlsClickLog:function(logContent,adContent){this.sendAls(this.buildAlsLogData(logContent,$.extend(adContent,{da_type:ALSLOG_TYPE.CLICK})));return this},sendAlsShowLog:function(logContent,adContent){this.sendAls(this.buildAlsLogData(logContent,$.extend(adContent,{da_type:ALSLOG_TYPE.SHOW})));return this}};return new AlsLog});
F.module("mancard:skeleton/presenter",function(require,exports,ctx){var global=window;var cards=require("skeleton/card_collection");var card_showLog=require("skeleton/card_showLog");var _topDom=$("#s_mancard_main");var _centerMen=$("#s_ctner_menus");var _centContent=$("#s_ctner_contents");var _menuContainer=$(".s-menu-container",_topDom);var _loadMap={};var _menuData=$.parseJSON($.trim($("#s_menus_textarea",_topDom).html()));var windowHeight=$(global).height();var isCardWater=true;function init(
){_initCards();_bindEvent()}var _loadHelper={defaulSub:300,tolerance:isCardWater?0:300,preTop:0,loaded:false,moreBar:_topDom.find(".s-more-bar"),judgeFire:function(){var _ctx=this;if(_ctx.tolerance===0||s_session.index_off){return}cards.get(cards.curId).appendData(function(data){_ctx.loaded=true},_loadHelper.toggleMore)},toggleMore:function(show){if(!show){_loadHelper.moreBar.remove()}else{_loadHelper.moreBar.show()}},moreUpFy:function(hasSkin,scroll){var _ctx=this;_loadHelper.moreBar.css({
visibility:"visible"});if(window.isNewGridCard){return}var fixTop;if(scroll){if(_ctx.moreUp){fixTop=_centContent.offset().top+_centContent.height()-$(global).height()-$(global).scrollTop();_loadHelper.moreBar.css({bottom:Math.min(Math.max(0,fixTop),10)})}}if($(global).height()<830){if(_ctx.moreUp!==true){_loadHelper.moreBar.addClass("s-more-up").appendTo(_centContent);_ctx.moreUp=true;fixTop=_centContent.offset().top+_centContent.height()-$(global).height()-$(global).scrollTop()
;_loadHelper.moreBar.css({bottom:Math.min(Math.max(0,fixTop),10)});repeat(true)}}else{if(_ctx.moreUp!==false){_loadHelper.moreBar.removeClass("s-more-up");_centContent.after(_loadHelper.moreBar);if(!_ctx.morePngLoaded){_loadHelper.moreBar.find(".rect")[0].onload=function(){_loadHelper.moreBar.css({visibility:"visible"})};_ctx.morePngLoaded=true}_ctx.moreUp=false}if(hasSkin===true){_loadHelper.moreBar.find(".rect").attr("src",s_domain.staticUrl+"static/mancard/img/more_white-2eea3778c1.png")
}else if(hasSkin===false){_loadHelper.moreBar.find(".rect").attr("src",s_domain.staticUrl+"static/mancard/img/more_black-0efeff6083.png")}}function repeat(turn){_loadHelper.moreBar.find(".animate-arrow").animate({top:turn?18:8},800,"swing",function(){repeat(!turn)})}},moreDownFy:function(){if($(global).height()>700){var moreBar=_topDom.find(".s-more-bar").addClass("s-more-up").find(".rect").attr("src",s_domain.staticUrl+(
global.s_session.userIsNewSkined==="on"?"static/mancard/img/more_white-2eea3778c1.png":"static/mancard/img/more_black-0efeff6083.png")).end();_centContent.after(moreBar)}}};function _initCards(){var _cardData=_menuData.data;var i=_cardData.length;while(i--){var item=_cardData[i];if(item.state==="1"){cards.add(item.id,item.name,item.state)}}if(s_session.curmod==="3"){cards.switchCard(100)}var curCard=cards.get(s_session.curmod);if(global._card_aync){if(_menuData.illegal){curCard.params.normal=1}
curCard.show(function(){if(_menuData.illegal){delete curCard.params.normal}})}else{curCard.rendered=true;curCard.noMore=!!parseInt(_menuData.isEnd,10);curCard.sessionId=global.s_session.sessionId}for(var i=0,syncRids=global.s_session.rids||[],l=syncRids.length;i<l;i++){curCard.ridsHash[syncRids[i]]=true}if(curCard.noMore){curCard.emitNoMore()}_loadHelper.toggleMore(!parseInt(_menuData.isEnd,10));setTimeout(function(){ctx.fire("modShow",{showTab:cards.curId,opType:"refresh"})
;card_showLog.itemShowLog()},1e3)}var _menuHelper={latestY:$(global).scrollTop(),barTop:_menuContainer.offset().top,barHeight:_centerMen.height(),topWrap:$("#s_top_wrap"),centTop:_centContent.offset().top+parseInt(_centContent.css("padding-top"),10),showed:false,overCenter:false,menuGurd:$("#s_menu_gurd",_topDom),container:$(".s-menu-container",_topDom),toolBar:$("#s_top_feed",_topDom),toolBarTop:Math.min(parseInt($("#s_top_feed",_topDom).css("top"),10),300),menuStatus:cards.options("menuStatus"
,0),toggleMenu:function(scrollTop){if($.isIE===6){return}var _ctx=this;if(scrollTop===_ctx.latestY){return}var measure=$.isIE===7?10:3;if(scrollTop<_ctx.latestY&&_ctx.barTop-scrollTop<=_ctx.topWrap.height()+measure){if(!_ctx.showed){cards.toggleMenu(true);_ctx.showed=true;cards.options("menuStatus",1)}}else{var noAnimate=_ctx.barTop-scrollTop>_ctx.topWrap.height()+measure;if(_ctx.showed){cards.toggleMenu(false,noAnimate);_ctx.showed=false}if(_ctx.barTop-scrollTop>_ctx.topWrap.height()){
cards.options("menuStatus",0)}else{cards.options("menuStatus",2)}}if(_ctx.centTop-scrollTop<_ctx.topWrap.height()){if(!_ctx.overCenter){ctx.fire("overCenter",{over:true});_ctx.overCenter=true}}else{if(_ctx.overCenter){ctx.fire("overCenter",{over:false});_ctx.overCenter=false}}_ctx.latestY=scrollTop},judgeMenu:function(top){var _ctx=this;var bottom1="228px";var bottom2="184px";if(top>0){if(window.isNewGridCard){_ctx.toolBar.show()}else{_ctx.toolBar.find(".to-top").css({visibility:"visible"})}$(
"#s_popup_advert").find(".advert-shrink").css({bottom:bottom1,transition:"none","-webkit-transition":"none","-moz-transition":"none","-o-transition":"none"})}else{if(window.isNewGridCard){_ctx.toolBar.hide()}else{_ctx.toolBar.find(".to-top").css({visibility:"hidden"})}$("#s_popup_advert").find(".advert-shrink").css({bottom:bottom2,transition:"none","-webkit-transition":"none","-moz-transition":"none","-o-transition":"none"})}},initAdjust:function(){var headDom=$("#head_wrapper");$(global).on(
"unload",function(){$(".s-news-rank-wrapper",_topDom).hide();headDom.removeClass("s-down");global.scrollTo(0,0)})},feedRoller:function(scrollTop){if($.isIE!==6){return}var _ctx=this;var _top=Math.min(_ctx.toolBarTop+scrollTop,_centContent.height()-_ctx.toolBar.height());_ctx.toolBar.css({top:_top})},initToolBar:function(IE6){var self=this;self.toolBar.css({visibility:"visible"});if(IE6){return}self.resetToolPos();$(global).on("resize",self.resetToolPos);$(global).on("scroll",self.resetToolPos)
;$(global).on("s-skinoff",self.resetToolPos);$(global).on("s-skinon",self.resetToolPos)},removeToolCalc:function(){var self=this;if($.isIE===6){return}self.resetToolPos(true)},resetToolPos:function(animate){var self=_menuHelper;var toolTop;var nomalTop;var minTop;var effect=animate===true?"animate":"css";if(!_loadHelper.loaded){nomalTop=$(global).height()-self.toolBar.height()-10;var maxTop=_centContent.offset().top+_centContent.outerHeight()-self.toolBar.height()-$(global).scrollTop()-1
;minTop=_centContent.offset().top+217-$(global).scrollTop();toolTop=Math.max(Math.min(nomalTop,maxTop),minTop)}else{nomalTop=$(global).height()-self.toolBar.height()-30;minTop=_centContent.offset().top+227-$(global).scrollTop();toolTop=Math.max(nomalTop,minTop)}if(self.rememberTop!==toolTop){self.toolBar[effect]({top:toolTop});self.rememberTop=toolTop}if($(window).width()<1e3){self.toolBar.css({left:501-$(window).scrollLeft()})}else{self.toolBar.css({left:"50%"})}}};function forceMenu(){
cards.toggleMenu(true);_menuHelper.showed=true;cards.options("menuStatus",1)}function _bindEvent(){var cardChange=null;_centerMen.delegate(".s-menu-item","click",function(e){var $this=$(this);var id=$this.attr("data-id");var fromCardId=cards.curId;if(cards.curId!==id){cards.switchCard(id,function(){_loadHelper.toggleMore(!parseInt(cards.get(cards.curId).waterPage,10)&&!cards.get(cards.curId).noMore)});_loadHelper.toggleMore(!parseInt(cards.get(cards.curId).waterPage,10)&&!cards.get(cards.curId
).noMore);ctx.fire("switchCard",{toCard:id,fromCard:fromCardId})}if(id==="100"){_topDom.find(".mine-tips").hide()}F.use("mancard:setting/card_setting",function(Cardsetting){Cardsetting.hide()});setTimeout(function(){ctx.fire("modShow",{showTab:cards.curId,opType:"click"});ctx.fire("modClick",{clickTab:cards.curId});card_showLog.itemShowLog()},500);F.use("superman:common/user_attr",function(userAttr){if(userAttr.getAttr&&userAttr.getAttr("firstMahattan")){var ids=cards.getMenuIDS().join(",")
;$.ajaxpost(s_domain.baseuri+"/pcweb/submit/mancardmod",{cmd:"sort",ids:ids});userAttr.setAttr("firstMahattan","off")}});e.stopPropagation()}).delegate(".s-menu-item","mouseenter",function(e){var elem=$(this);var id=elem.attr("data-id");var start=+new Date;_loadMap[id]={start:start};_loadMap[id].timeId=setTimeout(function(){if(!cards.get(id).rendered){cards.get(id).render()}},150);e.stopPropagation()}).delegate(".s-menu-item","mouseleave",function(e){var elem=$(this);var id=elem.attr("data-id")
;var cur=_loadMap[id];var end=+new Date;if(cur&&cur.start){if(end-cur.start<150){clearTimeout(cur.timeId)}}e.stopPropagation()}).delegate(".s-menu-setting","click",function(e){F.use("mancard:setting/card_setting",function(Cardsetting){if(!Cardsetting.isShow()){Cardsetting.show({current:$("#s_menus_wrapper").find(".current").attr("data-id")})}else{Cardsetting.hide()}})}).delegate(".s-music-entry","mouseenter",function(){F.call("newmusic:player_exp","init")});_topDom.delegate(".s-more-bar","click"
,function(e){_loadHelper.tolerance=_loadHelper.defaulSub;_loadHelper.judgeFire();ctx.fire("loadMoreClick");e.stopPropagation()}).delegate(".to-top","click",function(e){$("body,html").animate({scrollTop:0});ctx.fire("gotoTopClick");e.stopPropagation()});_topDom.delegate("#s_top_feed .to-top","mouseenter mouseleave",function(e){if(e.type==="mouseenter"){$(this).addClass("icon-over");$("#s_qrcode_feed .qrcode-tooltip").hide()}else if(e.type==="mouseleave"){$(this).removeClass("icon-over")}
e.stopPropagation()}).delegate("#s_qrcode_feed .qrcode-layer","mouseenter mouseleave",function(e){if(e.type==="mouseenter"){$(this).addClass("icon-over");$(this).next(".qrcode-tooltip").show().addClass("popup")}else if(e.type==="mouseleave"){$(this).removeClass("icon-over");$(this).next(".qrcode-tooltip").removeClass("popup")}e.stopPropagation()});ctx.listen(["mancard:setting/card_setting","superman:common/bottom_layer","superman:mngr/menu_common"],["hideMain","showSet","hideSet"],function(data
){var wraper;if(data.cmd==="add"){(cards.get(data.id)||cards.add(data.id,data.name,"1")).add2Men();cardChange=data.id}else if(data.cmd==="del"){var first=0;cards.get(data.id).del4Men();for(first in cards.pool){break}cardChange=first}else if(data.cmd==="sort"){wraper=$("#s_menus_wrapper");$.each(data.ids,function(idx,item){cards.get(item).getMyMen().appendTo(wraper)})}else if(data._EVENT_NAME==="hideMain"){var delay=$("#s_top_wrap").hasClass("s-down")?$.isIE===8||$.isIE===7?2500:400:0;$(
"html,body").animate({scrollTop:0},delay,function(){$("#head_wrapper").addClass("s-ps-islite");$("#s_main").hide();$("#s_mancard_newmusic").hide();$("#s_mancard_newmusic").remove();$("#s_upfunc_menus .s-lite").removeClass("hide-icon");$("#bottom_layer .s-bottom-layer-right").addClass("hide-card");$("#s-user-setting-menu").addClass("hiding-feed");$(".s_form_wrapper").addClass("lite");if(s_session.isLogin){F.use("superman:common/user_attr",function(e){e.setAttr("isLite",true)})}});$("body"
).addClass("is-lite")}else if(data._EVENT_NAME==="showSet"){cardChange=null}else if(data._EVENT_NAME==="hideSet"){cardChange=null;wraper=$("#s_menus_wrapper");var currentIds=cards.getMenuIDS();var sMenuMusic=$(".s-menu-music");if(sMenuMusic.length>0&&sMenuMusic.css("display")!=="none"){currentIds.unshift(sMenuMusic.attr("data-id"))}$.each(currentIds,function(idx,item){if($.inArray(item,data.ids)===-1){if(item==="3"){sMenuMusic.find(".s-music-entry").hide();F.call("newmusic:index","stop")}
cards.get(item).del4Men();cards.get(item).getMyMen().removeClass("current")}});$.each(data.items,function(idx,item){if(cards.get(item.id)){var node=cards.get(item.id).getMyMen();node.css("display","");if(item.id==="3"){node.appendTo(wraper.parent());sMenuMusic.find(".s-music-entry").show();$("#s_mancard_newmusic").show();F.call("newmusic:index","init")}else{node.appendTo(wraper)}if(node.hasClass("current")){cardChange=item.id}}else{cards.add(item.id,item.name,"1").add2Men()}});if(
data.items.length===0||data.items.length===1&&data.ids[0]==="3"){cardChange="100"}if(s_session.curmod==="100"){return}if(cardChange!==s_session.curmod){if(cardChange!==null){cards.switchCard(cardChange)}else{cardChange=data.ids[0]==="3"?data.ids[1]:data.ids[0];cards.switchCard(cardChange)}}}});ctx.listen("superman:page/scroll","outMenu",function(data){if(!data.out){$("#s_top_wrap .s-top-nav").css("display","none")}});_loadHelper.moreUpFy();$(global).bind("resize",function(e){windowHeight=$(this
).height();_menuHelper.barTop=_menuContainer.offset().top;_loadHelper.moreUpFy(undefined,true)}).on("scroll",function(e){if(s_session.index_off||s_session.index_guide){return}var scrollTop=$(this).scrollTop();var totalHeight=$(document).height();if(Math.abs(scrollTop+windowHeight-totalHeight)<=_loadHelper.tolerance&&_loadHelper.preTop<scrollTop){_loadHelper.judgeFire()}_loadHelper.preTop=scrollTop;_menuHelper.judgeMenu(scrollTop);_menuHelper.toggleMenu(scrollTop);_menuHelper.feedRoller(scrollTop
);setTimeout(function(){card_showLog.itemShowLog()},300);_loadHelper.moreUpFy(undefined,true)});$(global).on("s-skinon",function(){_loadHelper.moreUpFy(true)});$(global).on("s-skinoff",function(){_loadHelper.moreUpFy(false)});$(document).on("mousewheel",function(e){reload(e)}).on("keydown",reload);function reload(e){if(s_session.index_guide){return}if(document.documentElement.scrollHeight<=document.documentElement.clientHeight&&e.deltaY<0||$(global).scrollTop()+$(global).height()-$(document
).height()>=-2&&_loadHelper.tolerance===0&&(e.deltaY<0||e.keyCode===40)){_loadHelper.tolerance=_loadHelper.defaulSub;_loadHelper.judgeFire()}}var bottomChange=false;ctx.listen("mancard:skeleton/card","beforeLoading",function(){if(!bottomChange){$("#bottom_container").appendTo("#s_wrap");bottomChange=true}})}exports.init=init;exports.forceMenu=forceMenu;exports.judgeFire=function(){_loadHelper.tolerance=300;_loadHelper.judgeFire()}});F.call("mancard:skeleton/presenter","init");
F.module("mancard:skeleton/card_tab",function(require,exports,ctx){var cards=require("skeleton/card_collection");var re=/childId=(.+);/;var reLasttab=/lasttab/;function CardTab(options){this.initialize(options)}CardTab.prototype={initialize:function(options){var self=this;var option=F.mix({cardName:null,componentWrap:null,content:null,cardTabClass:"card-tab",tabNameClass:"tab-name",tabNameCurClass:"tab-name-cur",tabContentClass:"tab-content",tabContentWrapClass:"tab-content-wrap",
dataTabName:"data-childid"},options);self.cardName=option.cardName;self.componentWrap=option.componentWrap;self.content=option.content;self.tabNameClass=option.tabNameClass;self.tabNameCurClass=option.tabNameCurClass;self.tabContentClass=option.tabContentClass;self.dataTabName=option.dataTabName;self.mainDom=self.componentWrap.parent();var id=self.mainDom.attr("data-id");self.card=cards.get(id);self.sessionIds={};self.offsets={};self.noMores={};self.dataWaterPara="";self.render(option)
;self.bindEvent()},render:function(options){var self=this;self.tabs=self.componentWrap.find("."+options.cardTabClass);self.curTab=self.tabs.find("."+self.tabNameCurClass).attr(self.dataTabName);self.dataWaterPara=self.mainDom.attr("data-waterpara")||"";if(!self.dataWaterPara.match(re)){self.dataWaterPara=self.dataWaterPara+"childId="+self.curTab+";";self.mainDom.attr("data-waterpara",self.dataWaterPara)}self.componentWrap.attr("data-curtab",self.curTab);self.content.wrap(
'<div class="'+options.tabContentWrapClass+'"></div>');self.contentWrap=self.componentWrap.find("."+options.tabContentWrapClass);self.content.addClass("tab-content").attr(self.dataTabName,self.curTab).attr("data-load","loaded").show();self.sessionIds[self.curTab]=self.card.sessionId;self.offsets[self.curTab]=self.card.waterPage;self.noMores[self.curTab]=self.card.noMore},bindEvent:function(){var self=this;var tpl=['<div class="s-content-load s-opacity-white-background">',
'<img src="#{staticUrl}static/mancard/img/loading-f9b765014b.gif" />',"<div>加载中，精彩马上呈现</div>","</div>"].join("");tpl=$.formatString(tpl,{staticUrl:s_domain.staticUrl});var targetTabglobal;ctx.listen("mancard:skeleton/card",["syncNomore"],function(data){self.sessionIds[targetTabglobal]=self.card.sessionId;self.card.sessionId=self.sessionIds[self.curTab];self.card.noMore=true;self.noMores[targetTabglobal]=self.card.noMore;self.contentWrap.find("["+self.dataTabName+'="'+targetTabglobal+'"]').attr(
"data-load","loaded").append(data);self.card.setForceLoad(false)});self.tabs.delegate("."+self.tabNameClass,"mouseenter",function(e){var that=this;var preName=$(this).prop("className");if(reLasttab.exec(preName)&&reLasttab.exec(preName)[0]==="lasttab"){return}var targetTab=$(this).attr(self.dataTabName);targetTabglobal=targetTab;var targetContent=self.contentWrap.find("["+self.dataTabName+'="'+targetTab+'"]');if(targetContent.length===0){targetContent=$(
'<div class="'+self.tabContentClass+'"></div>').attr(self.dataTabName,targetTab).appendTo(self.contentWrap);targetContent.attr("data-load","loading").append(tpl);self.card.setForceLoad(true);self.card.addParam("childId",targetTab);self.card.load(function(data){self.sessionIds[targetTab]=self.card.sessionId;self.card.sessionId=self.sessionIds[self.curTab];self.card.noMore=self.noMores[targetTab]||false;self.noMores[targetTab]=self.card.noMore;self.card.ridsHash={};targetContent.attr("data-load",
"loaded").append(data);self.card.setForceLoad(false);if(self.curTab===targetTab){if(!$(that).attr("data-firstLoad")){self.card.waterLoading=false;self.card.appendData(function(data){$("#s_mancard_main").find(".s-more-bar").hide();$(that).attr("data-firstLoad",1)},false,targetContent)}}self.contentWrap.find(".s-content-load").remove()})}}).delegate("."+self.tabNameClass,"click",function(e){var that=this;e.stopPropagation();var preName=$(this).prop("className");if(reLasttab.exec(preName
)&&reLasttab.exec(preName)[0]==="lasttab"){ctx.fire("clicklastTab");return}$(that).trigger("mouseenter");var curTab=self.tabs.find("."+self.tabNameCurClass).removeClass(self.tabNameCurClass).attr(self.dataTabName);var targetTab=$(this).addClass(self.tabNameCurClass).attr(self.dataTabName);self.dataWaterPara=self.dataWaterPara.replace(re,"childId="+targetTab+";");self.mainDom.attr("data-waterpara",self.dataWaterPara);ctx.fire("clickTab",{tabName:$(this).prop("className"),childId:$(this).attr(
"data-childid")});if(curTab===targetTab){return}self.offsets[curTab]=self.card.waterPage;self.noMores[curTab]=self.card.noMore;self.card.waterPage=self.offsets[targetTab]||0;self.card.noMore=self.noMores[targetTab]||false;self.card.ridsHash={};self.card.sessionId=self.sessionIds[targetTab];if(!self.card.noMore){self.card.resetNoMore()}else{$(".load-done").remove();$(".s-content-load").remove();self.card.emitNoMore()}var curContent=self.contentWrap.find("["+self.dataTabName+'="'+curTab+'"]')
;var targetContent=curContent.siblings("["+self.dataTabName+'="'+targetTab+'"]');curContent.hide();targetContent.show();self.curTab=targetTab;if(self.card.id!="5"){self.setTargetTab(targetTab)}self.card.waterDom=targetContent;if(!self.sessionIds[targetTab]){return}self.card.waterLoading=false;if(!$(that).attr("data-firstLoad")){self.card.appendData(function(data){$("#s_mancard_main").find(".s-more-bar").hide();$(that).attr("data-firstLoad",1)},false,targetContent)}})},setTargetTab:function(tab,
cb){var self=this;F.use("mancard:skeleton/card_memory",function(cardMemory){cardMemory.setCardTab(self.cardName,tab);cb&&cb()})}};return CardTab});
F.module("mancard:setting/card_setting",function(require,exports,ctx){var Emitter=require("superui:util/emitter"),Dot=require("superui:util/dot"),userAttr=require("superman:common/user_attr"),DotCardCompile=Dot.compile(['<div class="s-cardsetting" id="s_content_99" data-id="99">','<div class="s-cardsetting-wrap clearfix">','<div class="s-cardsetting-left">',"<h3>已订阅频道</h3>",
'<div style="float:left;width:78px;text-align:center;margin-top:18px;border:1px solid #cdcdcd;height:24px;line-height:24px;">我的关注</div>','<div class="s-cardsetting-content">',"{{~it.selected :value:index}}",'{{? (value.name!="音乐")}}','<div class="s-mod-item" id="s_moditem_{{=value.id}}" data-id="{{=value.id}}" data-imgname="{{=value.imgname}}" data-name="{{=value.name}}"{{ if(value.name == "音乐"&&!it.showMusic){ }} style="display:none;"{{ } }}>','<div class="s-mod-icon">',"</div>",
'<div class="s-mod-title">',"{{=value.name}}","</div>","</div>","{{?? it.showMusic}}",'<div class="s-mod-item s-mod-music s-mod-undraggable" id="s_moditem_{{=value.id}}" data-id="{{=value.id}}" data-imgname="{{=value.imgname}}" data-name="{{=value.name}}"{{ if(value.name == "音乐"&&!it.showMusic){ }} style="display:none;"{{ } }}>','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title">',"{{=value.name}}","</div>","</div>","{{?}}","{{~}}",'<div class="noremove-tips">',
'<p>亲，就剩我老哥一个了，不能再删了~可以尝试点击右下角“<a class="tips-hide" href="javascript:void(0)">隐藏卡片</a>”收起全部内容。</p>','<b class="close-icon" title="关闭"></b>',"</div>",'<div class="drag-tips">','<p>拖动可以排序<a class="i" href="javascript:void(0)">我知道了</a></p>',"<b></b>","</div>","</div>","</div>",'<div class="s-cardsetting-right">',"<h3>未订阅频道</h3>",'<div class="s-cardsetting-content">',"{{~it.unselected :value:index}}",'{{? (value.name!="音乐")}}',
'<div class="s-mod-item" id="s_moditem_{{=value.id}}" data-id="{{=value.id}}" data-imgname="{{=value.imgname}}" data-name="{{=value.name}}"{{ if(value.name == "音乐"&&!it.showMusic){ }} style="display:none;"{{ } }}>','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title">',"{{=value.name}}","</div>","</div>","{{?? it.showMusic}}",
'<div class="s-mod-item s-mod-music s-mod-undraggable" id="s_moditem_{{=value.id}}" data-id="{{=value.id}}" data-imgname="{{=value.imgname}}" data-name="{{=value.name}}"{{ if(value.name == "音乐"&&!it.showMusic){ }} style="display:none;"{{ } }}>','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title">',"{{=value.name}}","</div>","</div>","{{?}}","{{~}}","</div>","</div>","</div>",'<div class="s-cardsetting-set-wrapper">','<div class="s-cardsetting-set clearfix">',"{{? it.expand}}",
"{{~it.expand :value:index}}","{{? value.tipsunknown}}",'<span class="scene-recomm-unknown"></span>',"{{?}}",'<a href="#" onclick="return false;"  class="hide-mods {{=value.otherClassName}}"  hidefocus><span class="{{=value.borderClass}} {{=value.reviewCheck}}" id="{{=value.myId}}" data-attr="{{=value.tips}}"></span><span>{{=value.description}}</span></a>',"{{~}}",
'<a href="#" onclick="return false;" class="hide-mods" id="s_hide_allmods" hidefocus=""><span class="bg"></span><span>隐藏卡片</span></a>',"{{?}}","</div>","</div>","</div>"].join("")),TIPS='<div class="s-mod-tips">',TIPS_ADDTEXT="",TIPS_REMOVETEXT="拖动到这里可以取消订阅",ITEM_HOVER_CLASS="mod-hover",EXPAND_CLASS="hide-mods",EXPAND_CLASS_QUERY="."+EXPAND_CLASS,ITEM_CLASS="s-mod-item",ITEM_CLASS_QUERY="."+ITEM_CLASS,ITEM_LEFTCLASS_QUERY=".s-cardsetting-left .s-cardsetting-content",
ITEM_RIGHTCLASS_QUERY=".s-cardsetting-right .s-cardsetting-content",Draggselect=require("superui:component/draggselect"),UserAttr=require("superman:common/user_attr"),Dialog=require("superui:component/dialog"),componentLog=require("superui:component"),CANREMOVE=true,FromDrag=false,cards=require("skeleton/card_collection"),URLS={mod:s_domain.baseuri+"/pcweb/submit/mancardmod",menu:s_domain.baseuri+"/pcweb/submit/mancardmenu"},musicId;var _dragItem=null;function Cardsetting(){this.initialize()}
Cardsetting.prototype={constructor:Cardsetting,initialize:function(){this.main=$("#s_main");this.textarea=$("#s_menus_textarea");this.addedcache=[];if(this.textarea.length){this.selected=[];this.unselected=[];this.cache=$.parseJSON(this.textarea.val());this.render()}this.__datas=[]},renderTips:function(){var tips,self=this;self.dialog.body.on("click",".scene-recomm-unknown",function(){if(!tips){F.use("superui:component/tips",function(Tips){var unknown=$(".scene-recomm-unknown",self.dialog.body)
;tips=new Tips({componentWrap:self.dialog.body,target:unknown,identity:"scene-recommend",content:['<div class="scene-recommend-content">','<div class="scene-recommend-content">',"<h2>情景推荐模式：</h2>",'<p class="title">即当您登录百度首页时，页面会优先切换到您此时可能感兴趣的内容。</p>',"<p>例：您习惯看各种资讯，一大早打开电脑，会优先给您推荐新闻；闲暇时会给您切换至视频卡片供您舒缓神经。</p>",'<p class="last s-opacity-border4-top">如若您不喜欢，取消勾选框中的√即可，感谢您的使用~</p>',"</div>"].join(""),align:"center",arrowLeft:"right",autoShow:false,hasClose:false,width:388,theme:"scene-recommend"})})
}tips.show()})},render:function(){var self=this,expand=[];var myItem=null;F.each(self.cache.data,function(item){if(+item.id===100){myItem=item}if(+item.ismenu===1){if(+item.state===1){if(+item.id===3){self.selected.unshift(item);if(!window.s_session.audioModernizr){musicId=item.id}}else{self.selected.push(item)}}else{self.unselected.push(item)}}});if(s_session.strategy_hit===2){expand.push({otherClassName:"content-mod",borderClass:"choice-border",tips:"mouseScrollGuide",myId:"mouseScroll_mod",
description:"滚轮切换卡片",reviewCheck:s_session.userTips["mouseScrollGuide"]?"checked":""})}expand.push({otherClassName:"content-mod",borderClass:"choice-border",tips:"conRecommendTip",myId:"conRecommend_mod",description:"情景推荐",tipsunknown:true,reviewCheck:s_session.userTips["conRecommendTip"]?"checked":""});self.expand=expand},init:function(){var self=this;dialog=self.dialog;dialog.body.on("mouseenter mouseleave",ITEM_CLASS_QUERY,function(event){var target=$(event.target).closest(ITEM_CLASS_QUERY)
;target[event.type=="mouseenter"?"addClass":"removeClass"](ITEM_HOVER_CLASS)});self.bindDrag();dialog.on("onHide",function(cur){$("#s_main").removeClass("sui-cardsetting-main");s_session.skeleton_stopanimated=false;var items=self.getItems(),data={};ctx.fire("hideSet",items);self.dialog.log("hide")});self.bindEvent()},bindEvent:function(){var self=this,iKonwNode=self.dialog.body.find(".drag-tips"),hideNode=self.dialog.body.find(".tips-hide"),closeTipsNode=self.dialog.body.find(".close-icon")
;iKonwNode.on("click",function(){F.use("common/user_attr",function(e){e.setAttr("settingDragTips",false);iKonwNode.css("display","none")})});hideNode.on("click",function(e){self.hideMain();e.stopPropagation()});$(document).on("mousedown",function(e){if($(e.target).hasClass("menu-icon")){return}self.hide();FromDrag=false});closeTipsNode.on("click",function(e){self.dialog.body.find(ITEM_LEFTCLASS_QUERY).find(".noremove-tips").css("display","none")});ctx.listen("mancard:skeleton/presenter",
"overCenter",function(data){if(!!data.over){self.hide()}});ctx.listen("mancard:skeleton/card_collection","showTopMenu",function(data){if(!data.show){self.hide()}});$(window).on("scroll",function(){})},save:function(){var self=this,packed=self.packed;setTimeout(function(){ctx.fire("modOperate",packed)},100)},pack:function(data){var self=this,ids,item=data.dragItem;self.packed={ismenu:1,cmd:data.type=="added"?"add":data.type=="remove"?"del":"sort"};ids=self.getIDS();self.packed.ids=ids.ids
;self.packed.names=ids.names;if(item){self.packed.id=item.attr("data-id");self.packed.name=item.attr("data-name")}self.save()},getIDS:function(){var ids={ids:[],names:[]},select=this.draggselect.selected,drags=select.drags,cache=select.cache;F.each(cache,function(item){var drag=drags.eq(item),dataid=drag.attr("data-id"),name=drag.attr("data-name");ids.ids.push(dataid);ids.names.push(name)});return ids},getItems:function(){var items=[],ids=[],select=this.draggselect.selected,drags=select.drags,
cache=select.cache;F.each(cache,function(item){var drag=drags.eq(item),dataid=drag.attr("data-id"),name=drag.attr("data-name");ids.push(dataid);items.push({name:name,id:dataid})});return{ids:ids,items:items}},tips:function(){var self=this,current,target,draggselect=self.draggselect;current=draggselect.selected;target=draggselect.unselected;if(!current.tipsmessage){current.tipsmessage=$(TIPS).html(TIPS_REMOVETEXT).appendTo(current.wrap)}if(!target.tipsmessage){target.tipsmessage=$(TIPS).html(
TIPS_ADDTEXT).appendTo(target.wrap)}if(current.total==0){target.tipsmessage.show();current.tipsmessage.hide()}else{target.tipsmessage.hide();if(target.total==0){target.tipsmessage.hide();current.tipsmessage.show()}else{current.tipsmessage.hide()}}target.tipsmessage.hide()},cacheAdded:function(data){var self=this,index,id,cache=this.addedcache;if(data.dragItem){id=data.dragItem.attr("data-id");index=$.inArray(id,cache);if(index>-1){cache.splice(index,1)}if(data.type=="added"){cache.push(id)}}},
bindDrag:function(){var self=this,dialog=self.dialog,leftHave;if(dialog.body.find(ITEM_LEFTCLASS_QUERY).width()>530){self.bugtotal=self.bugtotal||0;if(self.bugtotal++<100){return setTimeout(function(){self.bindDrag()},200)}}self.draggselect=new Draggselect({identity:"cardsetting",containment:dialog.body,selected:dialog.body.find(ITEM_LEFTCLASS_QUERY),unselected:dialog.body.find(ITEM_RIGHTCLASS_QUERY),dragsort:ITEM_CLASS_QUERY,cansort:false,afterAnimateTime:100});self.draggselect.on(
"onBeforeSelect",function(data){_dragItem=data.dragItem;_dragItem.css("zoom","0");var parent=data.dragItem.parent().parent();self.dialog.body.find(".drag-tips").css("display","none");if(data.dragItem){data.dragItem.removeClass(ITEM_HOVER_CLASS);if(_dragItem.text()==="音乐"){$(".sui-draggsort-holder").addClass("lock");self.draggselect.selected.__options.cansort=false}}});self.draggselect.on("onAfterSelect",function(data){setTimeout(function(){self.resort()},
self.draggselect.selected.__options.afterAnimateTime+50);self.draggselect.selected.__options.cansort=true;if(_dragItem){setTimeout(function(){_dragItem.css("zoom","1");_dragItem=null},50)}$(".sui-draggsort-holder").removeClass("lock")});self.draggselect.on("onBeforeSelectSwap",function(){self.dialog.body.find(".drag-tips").css("display","none");self.draggselect.selected.parentoffset=$(".s-cardsetting-left .s-cardsetting-content").offset();self.draggselect.unselected.parentoffset=$(
".s-cardsetting-right .s-cardsetting-content").offset()});self.draggselect.on("onSelectSwap",function(data){data.dragItem&&data.dragItem.removeClass("mod-hover");if(data.dragItem&&$.isIE){data.dragItem.removeClass("mod-hover");setTimeout(function(){},100)}self.checkLeave();switch(data.type){case"added":cmd="add";break;case"remove":cmd="del";var item=data.dragItem,img,src;self.cacheAdded(data);if(item&&item.length){if(data.type=="remove"){self.tips(true)}else{self.tips()}item.removeClass(
ITEM_HOVER_CLASS)}break;case"noremove":self.dialog.body.find(".drag-tips").hide();break;case"switch":cmd="sort";break}if(!_dragItem){self.resort()}self.pack(data);if(s_session.userTips.firstMahattan){F.use("superman:common/user_attr",function(userAttr){userAttr.setAttr("firstMahattan",false)})}$.ajaxpost(URLS.mod,{cmd:self.packed.cmd,id:data.dragItem?data.dragItem.attr("data-id"):undefined,ids:self.getModIds(self.packed.ids)},function(response){});var ids=cards.getMenuIDS()
;var newIds=self.getItems().ids;for(var i=0;i<ids.length;i++){var node=cards.get(ids[i]).getMyMen();if(node.hasClass("current")&&$.inArray(ids[i],newIds)==-1){$.ajaxpost(URLS.menu,{id:newIds[0]},function(response){})}}});self.draggselect.on("onAfterSelect",function(data){FromDrag=true;self.checkLeave()});self.draggselect.on("onResizeHeight",function(data){});self.draggselect.on("beforeMoving",function(){dialog.body.find(ITEM_LEFTCLASS_QUERY).find(".noremove-tips").css("display","none")})
;self.bindExpand();self.renderTips();self.tips(true);self.checkLeave()},checkLeave:function(){var self=this;leftHave=self.dialog.body.find(ITEM_LEFTCLASS_QUERY).find(ITEM_CLASS_QUERY).length;CANREMOVE=leftHave==1?false:true},bindExpand:function(){var self=this,dialog=self.dialog;dialog.body.on("click",function(event){var target=$(event.target).closest(EXPAND_CLASS_QUERY),span,expand,checked;if(target.length){span=target.find("span").eq(0);if(expand=span.attr("data-attr")){
checked=span.toggleClass("checked").hasClass("checked");UserAttr.setAttr(expand,checked);self.draggselect.log(expand,"checked="+checked)}else{self.draggselect.log("hidemain");self.hideMain()}return false}})},hideMain:function(onlyhide){if(!onlyhide){this.dialog.hide()}ctx.fire("hideMain")},show:function(data){var self=this,width;self.current=data.current;if(self.cache){if(!self.dialog){$("#s_main").addClass("sui-cardsetting-main");self.dialog=new Dialog({identity:"cardsetting",
width:width=self.main.width(),content:DotCardCompile({expand:self.expand,unselected:self.unselected,selected:self.selected,showMusic:window.s_session.audioModernizr}),position:function(){return{top:"36px",width:"895px",left:"0px"}},theme:"cardsetting",autoShow:false,hasMask:false,hasClose:false,componentWrap:$("#s_main"),hackToTop:false});self.dialog.on("onShow",function(){$("#s_main").addClass("sui-cardsetting-main");s_session.skeleton_stopanimated=true;if(!self.binded){setTimeout(function(){
self.init(self.binded=true)},100)}})}if(!s_session.userTips.settingDragTips||self.selected.length==0){self.dialog.body.find(".drag-tips").css("display","none")}self.dialog.show();self.beforeShow();if($.isIE6){$(".sui-dialog-cardsetting .sui-dialog-body").show()}else{if(true){$(".sui-dialog-cardsetting .sui-dialog-body").css({display:"block"});$(".sui-dialog-cardsetting").animate({height:"186px"},200)}else{}}ctx.fire("showSet")}self.dialog.hasshow=true;$(".sui-dialog-body").on("click",function(e
){e.stopPropagation()});self.dialog.body.on("mousedown",function(e){e.stopPropagation()});F.use("common/user_attr",function(e){e.setAttr("settingDragTips",false)})},hide:function(){var self=this;if(self.isShow()){if($.isIE6){$(".sui-dialog-cardsetting .sui-dialog-body").hide();self.dialog.hide()}else{$(".sui-dialog-cardsetting").animate({height:"0px"},200,function(){$(".sui-dialog-cardsetting .sui-dialog-body").css({display:"none"});self.dialog.hide()})}}},isShow:function(){if($(
".sui-dialog-cardsetting .sui-dialog-body").length==0||$(".sui-dialog-cardsetting .sui-dialog-body").css("display")=="none"){return false}else{return true}},beforeShow:function(){var self=this,topWrapper=$("#s_top_wrap"),settingNode=$(".sui-dialog-cardsetting");if(topWrapper.find("#s_menu_gurd").length>0){if($.isIE6){settingNode.css("position","absolute");settingNode.css("top",$(window).scrollTop()-$("#s_main").offset().top+110+"px")}else{settingNode.css("position","fixed");settingNode.css("top"
,"110px");settingNode.css("left",$("#s_main").offset().left)}}else{settingNode.css("position","absolute");settingNode.css("top","36px")}},resort:function(){var cache=this.draggselect.selected.cache;var musicPosition=parseInt($(".s-cardsetting-left .s-mod-music:last").attr("data-daraggsort"),10);if(!isNaN(musicPosition)){var position;for(var index=0,length=cache.length;index<length;index++){if(musicPosition===cache[index]&&index!==0){cache.splice(index,1);cache.unshift(musicPosition)
;this.draggselect.selected.sort(false,true);break}}}},getModIds:function(ids){var ids=ids;if(musicId!==undefined&&!($.inArray(ids,musicId)>-1)){ids.unshift(musicId)}return ids.join(",")}};return new(F.inherit(Cardsetting,Emitter))});
F.module("mancard:subscribe/parabola",function(require,exports,ctx){(function(){var lastTime=0;var vendors=["webkit","moz"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date
).getTime();var timeToCall=Math.max(0,16.7-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})();var defaults={speed:166.67,curvature:.001,progress:function(){},complete:function(){callback&&callback()}};var element,target,callback;var params={},options=options||{};for(var key in defaults){
params[key]=options[key]||defaults[key]}exports={mark:function(){return this},position:function(){return this},move:function(){return this},init:function(){return this}};var moveStyle="margin",testDiv=document.createElement("div");if("oninput"in testDiv){["","ms","webkit"].forEach(function(prefix){var transform=prefix+(prefix?"T":"t")+"ransform";if(transform in testDiv.style){moveStyle=transform}})}var a=params.curvature,b=0,c=0;var flagMove=true;var rectElement={},rectTarget={}
;var centerElement={},centerTarget={};var coordElement={},coordTarget={};exports.mark=function(){if(flagMove==false)return this;if(typeof coordElement.x=="undefined")this.position();element.setAttribute("data-center",[coordElement.x,coordElement.y].join());target.setAttribute("data-center",[coordTarget.x,coordTarget.y].join());return this};exports.position=function(){if(flagMove==false)return this;var scrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft,
scrollTop=document.documentElement.scrollTop||document.body.scrollTop;if(moveStyle=="margin"){element.style.marginLeft=element.style.marginTop="0px"}else{element.style[moveStyle]="translate(0, 0)"}rectElement=element.getBoundingClientRect();rectTarget=target.getBoundingClientRect();centerElement={x:rectElement.left+(rectElement.right-rectElement.left)/2+scrollLeft,y:rectElement.top+(rectElement.bottom-rectElement.top)/2+scrollTop};centerTarget={x:rectTarget.left+(rectTarget.right-rectTarget.left
)/2+scrollLeft,y:rectTarget.top+(rectTarget.bottom-rectTarget.top)/2+scrollTop};coordElement={x:0,y:0};coordTarget={x:-1*(centerElement.x-centerTarget.x),y:-1*(centerElement.y-centerTarget.y)};b=(coordTarget.y-a*coordTarget.x*coordTarget.x)/coordTarget.x;return this};exports.move=function(){if(flagMove==false)return this;var startx=0,rate=coordTarget.x>0?1:-1;var step=function(){var tangent=2*a*startx+b;startx=startx+rate*Math.sqrt(params.speed/(tangent*tangent+1));if(
rate==1&&startx>coordTarget.x||rate==-1&&startx<coordTarget.x){startx=coordTarget.x}var x=startx,y=a*x*x+b*x;element.setAttribute("data-center",[Math.round(x),Math.round(y)].join());if(moveStyle=="margin"){element.style.marginLeft=x+"px";element.style.marginTop=y+"px"}else{element.style[moveStyle]="translate("+[x+"px",y+"px"].join()+")"}if(startx!==coordTarget.x){params.progress(x,y);window.requestAnimationFrame(step)}else{params.complete();flagMove=true}};window.requestAnimationFrame(step)
;flagMove=false;return this};exports.init=function(el,tar,cb){element=el;target=tar;callback=cb;this.position().mark().move()};return exports});
F.module("mancard:subscribe/subscribe",function(require,exports,ctx){var cardCollection=require("mancard:skeleton/card_collection");var SubDom=["s_ctner_contents"],isSubscribe=false,actItem,aniStarNode=$('<div class="sub-anistar"><b></b></div>'),aniPicNode=$('<div class="sub-anipic">                            <div class="sub-ie-mask"></div>                        </div>'),aniStarNodes=[],aniAddNode=$('<div class="sub-aniadd"></div>'),aniStarAddNode=$('<div class="sub-anistaradd"></div>'),
bodyNode=$("#head"),submitURL=s_domain.baseuri+"/subscribe/submit/manoperation ",DATA_HOOK="data-subscribe",DATA_RID="data-rid",DATA_SUBPARAM="data-subparam",count=0;var Tips=require("superui:component/tips");var bindEvent=function(item){$("#"+item).on("mouseenter mouseleave","["+DATA_HOOK+"]",function(e){var t=e.target;if(e.type==="mouseenter"){window.debugenter=function(){var curSubNode;if((curSubNode=$(this).find(".subscribe"))[0]){curSubNode.show();if($(this).attr(DATA_HOOK)=="1"){
_resetSubNode("1",curSubNode)}else{_resetSubNode("0",curSubNode)}return}var subNode=$('<div class="subscribe" data-click="LOG_BTN_SUB"><div class="sub"><em class="sub-bg"></em><b class="sub-star"></b><span class="sub-txt" style="display:none">已关注</span></div></div>');if($(this).attr(DATA_HOOK)=="1"){_resetSubNode("1",subNode)}else{_resetSubNode("0",subNode)}if($(this).find(".sub-contaniner").length>0){$(this).find(".sub-contaniner").append(subNode)}else{$(this).append(subNode)}if($.isIE6){
subNode.css("zoom","1")}};window.debugenter.call(this)}else{if(e.target!=$(this).find(".subscribe").find(".sub-star")[0]){$(this).find(".subscribe").css("zoom","0").detach()}}}).on("click",".subscribe",function(e){onSubscribe($(this),$(this));e.stopPropagation()})};var _resetSubNode=function(st,subNode){var subClassNode=subNode.children();if(st=="1"){subClassNode.removeClass("unsub");subClassNode.addClass("sub");subNode.attr("data-click","LOG_BTN_UNSUB");subNode.find(".sub-txt").text("已关注");if(
s_session.curmod=="20"){subNode.attr("title","已关注,点击取消")}}else if(st=="0"){subClassNode.removeClass("sub");subClassNode.addClass("unsub");subNode.attr("data-click","LOG_BTN_SUB");subNode.find(".sub-txt").text("关注");if(s_session.curmod=="20"){subNode.attr("title","添加到关注")}}};var onSubscribe=function(t,subNode){var node=t,actItem=node.parents("["+DATA_HOOK+"]"),subData=actItem.attr(DATA_HOOK),rId=actItem.attr(DATA_RID),subParam=actItem.attr(DATA_SUBPARAM),actName,defaultParam={id:rId};if(subParam
){var regx=/([^:]+):([^;]+);/gi,regResult;while(regResult=regx.exec(subParam)){defaultParam[regResult[1]]=regResult[2]}}if(subData=="1"){actName="del";defaultParam.cmd=actName;subDel(actItem,defaultParam,function(){actItem.attr(DATA_HOOK,"0");_resetSubNode("0",subNode)})}else{actName="add";defaultParam.cmd=actName;subAdd(actItem,defaultParam,function(){actItem.attr(DATA_HOOK,"1");_resetSubNode("1",subNode)})}actItem.parents(".s-xmancard").attr("data-subChange",1)};function subAdd(actItem,param,
cb){var pos=actItem.offset();var toPos=$("#s_menu_mine .mine-icon").offset();var a=aniPicNode.clone();a.attr("class","sub-anipic sub-anipic-"+s_session.curmod);var imgSrc=actItem.closest("["+DATA_RID+"]").find("img").attr("src");var reqParam={tabid:window.s_session.curmod,url:actItem.find("a").attr("href")||"",name:actItem.find("a").attr("title")||"",from:window.s_session.curmod};$.extend(reqParam,param);$.ajaxpost(submitURL,reqParam,function(response){var result=response.errNo;if(
result=="0"||result=="6004"){cb&&cb();ctx.fire("refresh",{tabid:reqParam.tabid,param:reqParam,response:response,actItem:actItem});if($.isIE6){return}if($.isIE&&$.browser.ie<9&&s_session.userSkinOpacity>20){a.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src='"+imgSrc+"')"})}else{a.css({"background-image":"url("+imgSrc+")"});a.css({filter:"none"})}setTimeout(function(){toPos=$("#s_menu_mine .mine-icon").offset();var tolerance=-parseInt($(
"#s_menu_gurd").css("margin-top"),10);a.animate({left:toPos.left-10+"px",top:toPos.top-7+tolerance+"px"},1e3,function(){a.fadeOut(function(){a.remove()});var startNode=aniStarAddNode.clone();startNode.css({left:toPos.left,top:toPos.top});bodyNode.append(startNode);startNode.show();startNode.animate({top:toPos.top-40,opacity:"0"},2e3,function(e){startNode.remove()})})},0);a.css({left:pos.left+45,top:pos.top});bodyNode.append(a);if(cardCollection.options("menuStatus")=="2"||cardCollection.options(
"menuStatus")=="1"){F.call("mancard:skeleton/presenter","forceMenu")}}else if(result=="501"){ctx.fire("showExceedTips",{tabid:reqParam.tabid})}else{}})}function subDel(actItem,param,cb){var reqParam={tabid:window.s_session.curmod,url:actItem.find("a").attr("href")||"",name:actItem.find("a").attr("title")||"",from:window.s_session.curmod};$.extend(reqParam,param);$.ajaxpost(submitURL,reqParam,function(response){var result=response.errNo;if(result=="0"){cb&&cb();setTimeout(function(){ctx.fire(
"refresh",{tabid:reqParam.tabid,param:reqParam,response:response,actItem:actItem})},1e3)}else{}})}exports.init=function(){$.each(SubDom,function(i,e){bindEvent(e)})};exports.subAdd=subAdd;exports.subDel=subDel});F.call("mancard:subscribe/subscribe","init");